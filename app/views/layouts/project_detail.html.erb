<!DOCTYPE html>
<html>
<head>
  <title>PropertyChecklist</title>
  <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/css/bootstrap-combined.min.css" rel="stylesheet">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.1/js/bootstrap.min.js"></script>
  <%= stylesheet_link_tag "application" %>
  <%= javascript_include_tag "application" %>
  <script type='text/javascript' src='https://cdn.firebase.com/v0/firebase.js'></script>
  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.0.0/moment.min.js"></script>
  <%= csrf_meta_tags %>
  <script type="text/javascript">
      (function() {
          if (typeof window.janrain !== 'object') window.janrain = {};
          if (typeof window.janrain.settings !== 'object') window.janrain.settings = {};

          janrain.settings.tokenUrl ='<%= ENV["AUTHENTICATION_LOGIN_URL"] %>';

          function isReady() { janrain.ready = true; };
          if (document.addEventListener) {
              document.addEventListener("DOMContentLoaded", isReady, false);
          } else {
              window.attachEvent('onload', isReady);
          }

          var e = document.createElement('script');
          e.type = 'text/javascript';
          e.id = 'janrainAuthWidget';

          if (document.location.protocol === 'https:') {
              e.src = 'https://rpxnow.com/js/lib/mypropertychecklist-in/engage.js';
          } else {
              e.src = 'http://widget-cdn.rpxnow.com/js/lib/mypropertychecklist-in/engage.js';
          }

          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(e, s);


      })();

  </script>

  <script type="text/javascript">

      $(document).ready(function(){
             $('input[type=submit]').css('display','none');
            $('input[type=radio]').click(function(){
              <% if session[:current_user_id].nil?  %>
                $("#modalLogin").modal('show');
              <% else %>
                this.parentElement.parentElement.parentElement.lastElementChild.click();
              <% end %>
            });

          $('input').iCheck({
              checkboxClass: 'icheckbox_flat-red',
              radioClass: 'iradio_flat-red'
          });

         //firebase client authentication
           var dataRef =  new Firebase("<%= ENV['FIREBASE_DATA_URL']%>");
           <%  unless  session[:current_user_id].nil?%>
                   console.log('<%= session[:firebase_auth_id]%>');
                  dataRef.auth('<%= session[:firebase_auth_id]%>', function(error){
                      if(error) {
                          console.log("Login Failed", error);
                      } else {
                          console.log("Login Succeeded");
                      }
                  });
          <% end %>
          // end of firebase client authentication
          var projectRef = dataRef.child('projects').child('<%= return_project_label_firebase(@project)%>');
         projectRef.child('comments').on('child_added', function(snapshot){
              var commentMetaData = snapshot.val();
              var comment_content = commentMetaData.comment_content;
              var user_name = commentMetaData.user_name;
             var comment_time = commentMetaData.timestamp;
             comment_time_moment = moment(comment_time, "YYYY-MM-DD HH:mm:ss");
              var insert_text = "<li>" + comment_content + "</li>" + "<li>" +user_name+ "&nbsp;&nbsp;" + comment_time_moment.fromNow() + "</li>";
              $("#comments_list").append(insert_text)
          });
          var some_moment_string = "2013-05-02 22:00:40";
          var some_moment = moment(some_moment_string, "YYYY-MM-DD HH:mm:ss" )
          console.log(some_moment.fromNow());
       });
      /*  for iCheck feature */
      $(function(){
          $('#sub_nav').affix({
              offset: $('#sub_nav').position()
          });

          $("#checklist_content").customScrollbar();
      });
  </script>
  <style type="text/css">
      #sub_nav.affix {
          position: fixed;
          top: 0;
          width: 100%
      }
      #checklist_content {
          height: 400px;
      }
  </style>
</head>
<body >
<div class="navbar navbar-inverse navbar-static-top">
  <div class="navbar-inner">
    <div class="container">
      <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <%= link_to "PropertyChecklist.in", root_path, class: "brand" %>
      <div class="nav-collapse collapse">
        <ul class="nav">
          <% if !session[:current_user_id].nil? %>
              <li> <%= link_to "Logout", {controller: "authentication", action: "logout" } %></li>
          <% end %>
        </ul>
      </div><!--/.nav-collapse -->
    </div>
  </div>
</div>

<div class="container" >
  <div class="row">
    <div class="span4">
     <div class="well well-large">
      <h4>Project Details</h4>
      <%= yield  :project_details %>
     </div>
    </div>
    <div class="span4">
     <div class="well well-large">
      <h4>Project Developer Details</h4>
      <%= yield  :project_developer_detail %>
     </div>
    </div>

  </div>

  <div class="navbar" id="sub_nav">
         <div class="navbar-inner">
           <ul class="nav">
             <%= yield :checklist_category %>
           </ul>
         </div>
  </div>
  <div class="row " >
    <div class="span7">
      <%= yield :project_checklist_user %>
    </div>
    <div class="span5" id="project_comments">
    <div class="well">
       <ul id="comments_list">
       </ul>
      <div class="navbar navbar-static-bottom">
         <div class="navbar-inner">
            <ul class="nav">
                   <form class="navbar-form pull-right">
                      <input type="text" class="span3">
                     <button type="submit" class="btn">Submit</button>
                   </form>
            </ul>
         </div>
      </div>
    </div>
    </div>
  </div>

</div>
<div id="modalLogin" class="modal hide fade">
  <div class="modal-header">
    <h5>Please login and then give your responses, otherwise they will <strong>NOT</strong>&nbsp;be saved</h5>
  </div>
   <div class="modal-body">
     <% if session[:current_user_id].nil? %>
         <div id="janrainEngageEmbed"></div>
     <% end %>
   </div>
   <div class="modal-footer">
      <button class="btn" data-dismiss="modal">Close</button>
   </div>
</div>

</body>
</html>
